<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Repeti√ß√£o Etiquetas Internas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .code-block { background: #f8f9fa; padding: 15px; border-left: 4px solid #dc3545; margin: 15px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üêõ Debug - Repeti√ß√£o das Etiquetas Internas</h1>
    
    <div class="debug-section">
        <h2>üîç Teste da L√≥gica Atual</h2>
        <div class="debug-result info">
            <p>Vamos simular exatamente o que o c√≥digo est√° fazendo:</p>
            <button onclick="simularLogica()">üß™ Simular L√≥gica Atual</button>
            <div id="simulacao-resultado" class="code-block" style="display: none;"></div>
        </div>
    </div>

    <div class="debug-section">
        <h2>üìã Cen√°rio de Teste</h2>
        <div class="debug-result warning">
            <p><strong>Configure na aplica√ß√£o e compare com a simula√ß√£o:</strong></p>
            <ul>
                <li>Base: 1000</li>
                <li>Quantidade: 3</li>
                <li>C√≥pias: 2</li>
                <li>Tipo: Somente Interna</li>
            </ul>
            <p><strong>Sequ√™ncia esperada:</strong> 1000, 1000, 1001, 1001, 1002, 1002</p>
        </div>
    </div>

    <div class="debug-section">
        <h2>üîß Poss√≠veis Problemas</h2>
        <div class="debug-result error">
            <h3>Hip√≥teses do que pode estar causando repeti√ß√£o:</h3>
            <ul>
                <li>Problema no c√°lculo do <code>numeroInterno</code> (√∫ltimos 4 d√≠gitos)</li>
                <li>Erro na l√≥gica do <code>padLeft</code></li>
                <li>Problema no loop de <code>numeroSequencial</code></li>
                <li>Erro no <code>baseNumber + numeroSequencial</code></li>
                <li>Problema na convers√£o <code>String(numeroAtual)</code></li>
            </ul>
        </div>
    </div>

    <script>
        // Reproduzir as fun√ß√µes do c√≥digo original
        const padLeft = (numStr, len) => (Array(len + 1).join('0') + numStr).slice(-len);

        function simularLogica() {
            const resultado = document.getElementById('simulacao-resultado');
            resultado.style.display = 'block';
            
            // Par√¢metros do teste
            const base = '1000';
            const qtd = 3;
            const copias = 2;
            const len = base.length;
            
            let output = `üß™ SIMULA√á√ÉO DA L√ìGICA ATUAL\\n`;
            output += `Par√¢metros: base="${base}", qtd=${qtd}, copias=${copias}, len=${len}\\n\\n`;
            
            // Converter base para n√∫mero inteiro
            const baseNumber = parseInt(base, 10);
            output += `baseNumber = parseInt("${base}", 10) = ${baseNumber}\\n\\n`;
            
            let etiquetasGeradas = [];
            
            // Simular o loop principal
            for (let numeroSequencial = 0; numeroSequencial < qtd; numeroSequencial++) {
                output += `--- LOOP ${numeroSequencial + 1}/${qtd} ---\\n`;
                
                // Calcular o n√∫mero atual da sequ√™ncia
                const numeroAtual = baseNumber + numeroSequencial;
                output += `numeroAtual = ${baseNumber} + ${numeroSequencial} = ${numeroAtual}\\n`;
                
                // Converter para string com padding
                const numeroFormatado = padLeft(String(numeroAtual), len);
                output += `numeroFormatado = padLeft("${numeroAtual}", ${len}) = "${numeroFormatado}"\\n`;
                
                // Para etiquetas internas, usar √∫ltimos 4 d√≠gitos
                const numeroInterno = numeroFormatado.length >= 4 ? numeroFormatado.slice(-4) : numeroFormatado;
                output += `numeroInterno = "${numeroFormatado}".slice(-4) = "${numeroInterno}"\\n`;
                
                output += `Gerando ${copias} c√≥pias de "${numeroInterno}":\\n`;
                
                // Gerar todas as c√≥pias deste n√∫mero
                for (let copia = 0; copia < copias; copia++) {
                    output += `  C√≥pia ${copia + 1}: "${numeroInterno}"\\n`;
                    etiquetasGeradas.push(numeroInterno);
                }
                
                output += `\\n`;
            }
            
            output += `\\nüè∑Ô∏è RESULTADO FINAL:\\n`;
            output += `Etiquetas geradas: [${etiquetasGeradas.join(', ')}]\\n`;
            output += `Total: ${etiquetasGeradas.length} etiquetas\\n\\n`;
            
            // Verificar se h√° repeti√ß√µes incorretas
            const esperado = ['1000', '1000', '1001', '1001', '1002', '1002'];
            const correto = JSON.stringify(etiquetasGeradas) === JSON.stringify(esperado);
            
            if (correto) {
                output += `‚úÖ RESULTADO CORRETO!\\n`;
                output += `Sequ√™ncia gerada confere com o esperado.`;
            } else {
                output += `‚ùå PROBLEMA DETECTADO!\\n`;
                output += `Esperado: [${esperado.join(', ')}]\\n`;
                output += `Gerado:   [${etiquetasGeradas.join(', ')}]\\n`;
                
                // An√°lise detalhada do problema
                if (etiquetasGeradas.length !== esperado.length) {
                    output += `\\nüîç Problema: Quantidade incorreta de etiquetas\\n`;
                    output += `Esperado: ${esperado.length}, Gerado: ${etiquetasGeradas.length}`;
                } else {
                    output += `\\nüîç Problema: Sequ√™ncia incorreta\\n`;
                    for (let i = 0; i < etiquetasGeradas.length; i++) {
                        if (etiquetasGeradas[i] !== esperado[i]) {
                            output += `Posi√ß√£o ${i}: esperado "${esperado[i]}", gerado "${etiquetasGeradas[i]}"\\n`;
                        }
                    }
                }
            }
            
            resultado.textContent = output;
        }
    </script>

</body>
</html>